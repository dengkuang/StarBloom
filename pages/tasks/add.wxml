<!-- pages/tasks/add.wxml -->
<!-- æ·»åŠ ä»»åŠ¡é¡µé¢ -->
<scroll-view class="container" scroll-y="true" enhanced="true" show-scrollbar="false">
  
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <view class="back-btn" bindtap="onBack">
        <text class="back-icon">â†</text>
      </view>
      <view class="header-info">
        <text class="page-title">æ·»åŠ ä»»åŠ¡</text>
        <text class="child-name" wx:if="{{childInfo}}">ä¸º {{childInfo.name}} æ·»åŠ ä»»åŠ¡</text>
      </view>
    </view>
  </view>

  <!-- è¡¨å•å†…å®¹ -->
  <view class="form-container">
    
    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="form-section">
      <text class="section-title">ğŸ“ åŸºæœ¬ä¿¡æ¯</text>
      
      <!-- ä»»åŠ¡åç§° -->
      <view class="form-item">
        <text class="form-label">ä»»åŠ¡åç§° *</text>
        <input 
          class="form-input {{errors.name ? 'error' : ''}}"
          placeholder="è¯·è¾“å…¥ä»»åŠ¡åç§°"
          value="{{formData.name}}"
          maxlength="20"
          data-field="name"
          bindinput="onInputChange"
        />
        <text class="error-text" wx:if="{{errors.name}}">{{errors.name}}</text>
      </view>
      
      <!-- ä»»åŠ¡æè¿° -->
      <view class="form-item">
        <text class="form-label">ä»»åŠ¡æè¿°</text>
        <textarea 
          class="form-textarea {{errors.description ? 'error' : ''}}"
          placeholder="è¯·æè¿°ä»»åŠ¡çš„å…·ä½“è¦æ±‚å’Œç›®æ ‡"
          value="{{formData.description}}"
          maxlength="100"
          data-field="description"
          bindinput="onInputChange"
        ></textarea>
        <text class="error-text" wx:if="{{errors.description}}">{{errors.description}}</text>
      </view>
      
      <!-- ç§¯åˆ†è®¾ç½® -->
      <view class="form-item">
        <text class="form-label">å¥–åŠ±ç§¯åˆ† *</text>
        <view class="points-selector">
          <button class="points-btn decrease" data-type="decrease" bindtap="onPointsChange">-</button>
          <text class="points-value">{{formData.points}} ç§¯åˆ†</text>
          <button class="points-btn increase" data-type="increase" bindtap="onPointsChange">+</button>
        </view>
        <text class="form-hint">å»ºè®®ï¼šç®€å•ä»»åŠ¡5-15ç§¯åˆ†ï¼Œä¸­ç­‰ä»»åŠ¡15-30ç§¯åˆ†ï¼Œå›°éš¾ä»»åŠ¡30-50ç§¯åˆ†</text>
      </view>
    </view>

    <!-- ä»»åŠ¡å±æ€§ -->
    <view class="form-section">
      <text class="section-title">âš™ï¸ ä»»åŠ¡å±æ€§</text>
      
      <!-- éš¾åº¦ç­‰çº§ -->
      <view class="form-item">
        <text class="form-label">éš¾åº¦ç­‰çº§</text>
        <picker 
          class="form-picker"
          mode="selector"
          range="{{options.difficulties}}"
          range-key="label"
          value="{{formData.difficulty}}"
          data-field="difficulty"
          bindchange="onPickerChange"
        >
          <view class="picker-display">
            <text class="picker-text">
              {{options.difficulties[formData.difficulty === 'easy' ? 0 : (formData.difficulty === 'medium' ? 1 : 2)].stars}} 
              {{options.difficulties[formData.difficulty === 'easy' ? 0 : (formData.difficulty === 'medium' ? 1 : 2)].label}}
            </text>
            <text class="picker-arrow">></text>
          </view>
        </picker>
      </view>
      
      <!-- ä»»åŠ¡ç±»åˆ« -->
      <view class="form-item">
        <text class="form-label">ä»»åŠ¡ç±»åˆ«</text>
        <picker 
          class="form-picker"
          mode="selector"
          range="{{options.categories}}"
          range-key="label"
          data-field="category"
          bindchange="onPickerChange"
        >
          <view class="picker-display">
            <text class="picker-text">
              {{formData.emoji}} 
              <block wx:for="{{options.categories}}" wx:key="value">
                <block wx:if="{{item.value === formData.category}}">{{item.label}}</block>
              </block>
            </text>
            <text class="picker-arrow">></text>
          </view>
        </picker>
      </view>
      
      <!-- ä»»åŠ¡ç±»å‹ -->
      <view class="form-item">
        <text class="form-label">ä»»åŠ¡ç±»å‹</text>
        <picker 
          class="form-picker"
          mode="selector"
          range="{{options.taskTypes}}"
          range-key="label"
          data-field="taskType"
          bindchange="onPickerChange"
        >
          <view class="picker-display">
            <text class="picker-text">
              <block wx:for="{{options.taskTypes}}" wx:key="value">
                <block wx:if="{{item.value === formData.taskType}}">{{item.label}}</block>
              </block>
            </text>
            <text class="picker-arrow">></text>
          </view>
        </picker>
      </view>
      
      <!-- é€‚åˆå¹´é¾„ -->
      <view class="form-item">
        <text class="form-label">é€‚åˆå¹´é¾„</text>
        <picker 
          class="form-picker"
          mode="selector"
          range="{{options.ageGroups}}"
          range-key="label"
          data-field="ageGroup"
          bindchange="onPickerChange"
        >
          <view class="picker-display">
            <text class="picker-text">
              <block wx:for="{{options.ageGroups}}" wx:key="value">
                <block wx:if="{{item.value === formData.ageGroup}}">{{item.label}}</block>
              </block>
            </text>
            <text class="picker-arrow">></text>
          </view>
        </picker>
      </view>
    </view>

    <!-- ä¹ æƒ¯æ ‡ç­¾ -->
    <view class="form-section">
      <text class="section-title">ğŸ·ï¸ ä¹ æƒ¯æ ‡ç­¾</text>
      <text class="section-desc">é€‰æ‹©è¿™ä¸ªä»»åŠ¡èƒ½åŸ¹å…»çš„å¥½ä¹ æƒ¯ï¼ˆæœ€å¤š5ä¸ªï¼‰</text>
      
      <view class="habit-tags-container">
        <view 
          wx:for="{{commonHabitTags}}" 
          wx:key="index"
          class="habit-tag {{formData.habitTags.indexOf(item) > -1 ? 'selected' : ''}}"
          data-tag="{{item}}"
          bindtap="onHabitTagToggle"
        >
          {{item}}
        </view>
      </view>
      
      <view class="selected-tags" wx:if="{{formData.habitTags.length > 0}}">
        <text class="selected-label">å·²é€‰æ‹©ï¼š</text>
        <text class="selected-count">{{formData.habitTags.length}}/5</text>
      </view>
    </view>

    <!-- æ“ä½œæç¤º -->
    <view class="form-section">
      <text class="section-title">ğŸ’¡ æ“ä½œæç¤º</text>
      
      <view class="form-item">
        <text class="form-label">å®Œæˆå»ºè®®</text>
        <textarea 
          class="form-textarea"
          placeholder="ç»™å­©å­ä¸€äº›å®Œæˆä»»åŠ¡çš„å°è´´å£«å’Œå»ºè®®"
          value="{{formData.tips}}"
          maxlength="200"
          data-field="tips"
          bindinput="onInputChange"
        ></textarea>
      </view>
    </view>

  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-btn reset-btn" bindtap="onReset" disabled="{{loading}}">
      é‡ç½®
    </button>
    <button class="action-btn save-btn" bindtap="onSave" disabled="{{loading}}">
      <text wx:if="{{loading}}">ä¿å­˜ä¸­...</text>
      <text wx:else>ä¿å­˜ä»»åŠ¡</text>
    </button>
  </view>

  <!-- å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
</scroll-view>

<!-- åŠ è½½é®ç½© -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <text class="loading-text">ä¿å­˜ä¸­...</text>
  </view>
</view>