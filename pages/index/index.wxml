<!-- å®¶é•¿ç®¡ç†é¦–é¡µ - é‡æ„ç‰ˆ -->
<scroll-view class="container" scroll-y="true" enhanced="true" show-scrollbar="false">
  
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header-section">
    <!-- ç”¨æˆ·ä¿¡æ¯å’Œæ—¥æœŸ -->
    <view class="user-header">
      <view class="user-info">
        <image class="user-avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
        <view class="user-details">
          <text class="welcome-text">ä½ å¥½ï¼Œ{{userInfo.nickName || 'å®¶é•¿'}}ï¼</text>
          <text class="date-text">{{currentDate}}</text>
        </view>
      </view>
      <view class="notification-icon" bindtap="onNotificationTap">
        <text class="icon">ğŸ””</text>
        <view class="badge" wx:if="{{unreadCount > 0}}">{{unreadCount}}</view>
      </view>
    </view>

    <!-- å­©å­ç®¡ç†åŒºåŸŸ -->
    <view class="child-management" wx:if="{{childrenList.length > 0}}">
      <text class="child-count">å…± {{childrenList.length}} ä¸ªå­©å­</text>
      <view class="child-actions">
        <button class="child-action-btn" bindtap="onAddChild">æ·»åŠ å­©å­</button>
      </view>
    </view>

    <!-- å­©å­é€‰æ‹©å™¨ -->
    <view class="child-selector-wrapper" wx:if="{{childrenList.length > 0}}">
      <child-selector
        childrenList="{{childrenList}}"
        currentChild="{{currentChild}}"
        selectedIndex="{{currentChildIndex}}"
        showPoints="{{true}}"
        bind:change="onChildSelectorChange"
        bind:toggle="onChildSelectorToggle"
      ></child-selector>
    </view>

    <!-- å½“å‰å­©å­ç»Ÿè®¡å¡ç‰‡ -->
    <view class="current-child-stats" wx:if="{{currentChild}}">
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-number">{{currentChild.totalPoints || 0}}</text>
          <text class="stat-label">æ€»ç§¯åˆ†</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{todayCompletedTasks || 0}}</text>
          <text class="stat-label">ä»Šæ—¥å®Œæˆ</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{todayEarnedPoints || 0}}</text>
          <text class="stat-label">ä»Šæ—¥è·å¾—</text>
        </view>
      </view>
    </view>
  </view>

  

  <!-- ä»»åŠ¡ç®¡ç†æ¨¡å— -->
  <view class="section-container" wx:if="{{childrenList.length > 0}}">
    <view class="section-header">
      <text class="section-title">ä»»åŠ¡ç®¡ç†</text>
      <button class="add-btn" bindtap="onAddTask" style="position: relative; left: 182rpx; top: 0rpx">æ·»åŠ ä»»åŠ¡</button>
    </view>
    
    <view class="task-list">
    <task-item 
        wx:for="{{Tasks}}" 
        wx:key="_id" 
        task="{{item}}"
        show-actions="{{true}}"
        bind:complete="onTaskComplete"
      ></task-item>
    </view>
  </view>

  <!-- å¥–åŠ±ç®¡ç†æ¨¡å— -->
  <view class="section-container" wx:if="{{childrenList.length > 0}}">
    <view class="section-header">
      <text class="section-title">å¥–åŠ±ç®¡ç†</text>
      <button class="add-btn" bindtap="onAddReward" style="position: relative; left: 182rpx; top: 0rpx">æ·»åŠ å¥–åŠ±</button>
    </view>
    
    <view class="reward-list">
      <block wx:for="{{Rewards}}" wx:key="_id">
        <reward-item 
          reward="{{item}}" 
          bind:exchange="onExchangeReward"
          bind:edit="onEditReward"
          bind:delete="onDeleteReward"
        ></reward-item>
      </block>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ - æ— å­©å­æ—¶æ˜¾ç¤º -->
  <view class="empty-child-state" wx:if="{{childrenList.length === 0}}">
    <image class="empty-icon" src="/images/empty-child.png" mode="aspectFit"></image>
    <text class="empty-title">è¿˜æ²¡æœ‰æ·»åŠ å­©å­</text>
    <text class="empty-desc">æ·»åŠ å­©å­ä¿¡æ¯ï¼Œå¼€å§‹ç§¯åˆ†å¥–åŠ±ç®¡ç†</text>
    <button class="add-child-btn-main" bindtap="onAddChild">æ·»åŠ å­©å­</button>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
</scroll-view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- é”™è¯¯æç¤º -->
<view class="error-overlay" wx:if="{{error}}">
  <view class="error-content">
    <text class="error-text">{{error}}</text>
    <button class="retry-button" bindtap="onRetry">é‡è¯•</button>
  </view>
</view>