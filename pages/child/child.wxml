<!-- 孩子视图页面 - 滚动屏设计 -->
<scroll-view class="container" scroll-y="true" enhanced="true" show-scrollbar="false" bindtap="onPageTap">
  
  <!-- 没有孩子数据时的提示 -->
  <view class="empty-state" wx:if="{{childrenList.length === 0 && !loading}}">
    <image class="empty-icon" src="/images/empty-child.png" mode="aspectFit"></image>
    <text class="empty-title">还没有孩子信息</text>
    <text class="empty-subtitle">请先添加孩子信息，开始管理任务和奖励</text>
    <button class="add-child-btn" bindtap="navigateToAddChild">添加孩子</button>
  </view>

  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">加载中...</text>
  </view>
  
  <!-- 头部区域 - 孩子信息和积分 -->
  <view class="header-section" wx:if="{{childrenList.length > 0}}" style="width: 750rpx; height: 646rpx; display: block; box-sizing: border-box">
    <!-- 孩子选择器 -->
    <view class="child-selector-wrapper">
      <child-selector
        childrenList="{{childrenList}}"
        currentChild="{{currentChild}}"
        selectedIndex="{{currentChildIndex}}"
        showPoints="{{true}}"
        bind:change="onChildSelectorChange"
        bind:toggle="onChildSelectorToggle"
      ></child-selector>
    </view>

    <!-- 积分卡片 -->
    <view class="points-card" wx:if="{{currentChild}}" style="height: 407rpx; box-sizing: border-box; width: 688rpx; display: block">
      <view class="points-header">
        <text class="points-title">我的积分</text>
        <text class="points-subtitle">努力获得更多积分吧！</text>
      </view>
      <view class="points-display">
        <text class="points-number">{{currentChild.totalPoints || 0}}</text>
        <text class="points-unit">分</text>
      </view>
      <view class="points-stats">
        <view class="stat-item">
          <text class="stat-number">{{todayPoints}}</text>
          <text class="stat-label">今日获得</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{weekPoints}}</text>
          <text class="stat-label">本周获得</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 任务完成情况 -->
  <view class="section" wx:if="{{currentChild}}">
    <view class="section-header">
      <text class="section-title">📝 我的任务</text>
      <text class="section-subtitle">完成任务获得积分</text>
    </view>
    
    <!-- 任务进度 -->
    <view class="task-progress">
      <view class="progress-info">
        <text class="progress-text">今日完成 {{completedTasksToday}}/{{totalTasksToday}} 个任务</text>
        <text class="progress-percent">{{taskCompletionRate}}%</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{taskCompletionRate}}%"></view>
      </view>
    </view>

    <!-- 待完成任务列表 -->
    <view class="task-list" wx:if="{{pendingTasks.length > 0}}">
      <view class="list-header">
        <text class="list-title">待完成任务</text>
      </view>
      <task-item 
        wx:for="{{pendingTasks}}" 
        wx:key="_id" 
        task="{{item}}"
        show-actions="{{true}}"
        bind:complete="onTaskComplete"
      ></task-item>
    </view>

    <!-- 已完成任务 -->
    <view class="completed-tasks" wx:if="{{completedTasks.length > 0}}">
      <view class="list-header">
        <text class="list-title">已完成任务</text>
      </view>
      <view class="completed-task-item" wx:for="{{completedTasks}}" wx:key="_id">
        <view class="task-info">
          <text class="task-name">{{item.name}}</text>
          <text class="task-points">+{{item.points}}分</text>
        </view>
        <text class="completed-badge">✓ 已完成</text>
      </view>
    </view>
  </view>

  <!-- 可兑换奖励 -->
  <view class="section" wx:if="{{currentChild}}">
    <view class="section-header">
      <text class="section-title">🎁 可兑换奖励</text>
      <text class="section-subtitle">用积分兑换心仪的奖励</text>
    </view>
    
    <view class="reward-list" wx:if="{{availableRewards.length > 0}}">
      <reward-item 
        wx:for="{{availableRewards}}" 
        wx:key="_id" 
        reward="{{item}}"
        show-actions="{{true}}"
        bind:exchange="onRewardExchange"
      ></reward-item>
    </view>
    
    <view class="empty-state" wx:else>
      <text class="empty-text">暂无可兑换的奖励</text>
    </view>
  </view>

  <!-- 全部奖励 -->
  <view class="section" wx:if="{{currentChild}}">
    <view class="section-header">
      <text class="section-title">🏆 全部奖励</text>
      <text class="section-subtitle">查看所有奖励项目</text>
    </view>
    
    <view class="reward-list" wx:if="{{allRewards.length > 0}}">
      <reward-item 
        wx:for="{{allRewards}}" 
        wx:key="_id" 
        reward="{{item}}"
        show-actions="{{item.pointsRequired <= (currentChild.totalPoints || 0)}}"
        bind:exchange="onRewardExchange"
      ></reward-item>
    </view>
    
    <view class="empty-state" wx:else>
      <text class="empty-text">暂无奖励项目</text>
    </view>
  </view>

  <!-- 空状态 - 无孩子时显示 -->
  <view class="empty-child-state" wx:if="{{childrenList.length === 0}}">
    <image class="empty-icon" src="/images/empty-child.png" mode="aspectFit"></image>
    <text class="empty-title">还没有添加孩子</text>
    <text class="empty-desc">请先添加孩子信息，开始积分奖励之旅</text>
    <button class="add-child-btn" bindtap="navigateToAddChild">添加孩子</button>
  </view>

  <!-- 底部安全区域 -->
  <view class="safe-area-bottom"></view>
</scroll-view>

<!-- 加载状态 -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <text class="loading-text">加载中...</text>
  </view>
</view>