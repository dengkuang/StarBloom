# 模板导入调试指南

## 问题分析
根据用户反馈"模板页面 导入模板 导入失败"，我们创建了调试工具来帮助定位问题。

## 调试工具使用方法

### 1. 部署云函数
首先部署以下云函数：
- `manageTemplateData` - 已增强错误处理
- `initTemplateCollections` - 新建，用于初始化集合
- `initDatabase` - 已存在，用于完整数据库初始化

### 2. 使用调试页面
1. 在微信开发者工具中打开项目
2. 导航到 `pages/template-debug/template-debug` 页面
3. 按以下顺序执行测试：

#### 测试步骤：
1. **测试数据库连接** - 检查集合是否存在和可访问
2. **初始化数据库集合** - 创建必要的集合（如果不存在）
3. **测试单个模板导入** - 验证基本导入功能
4. **清理测试数据** - 删除测试数据

### 3. 查看日志
调试页面会在控制台和页面上显示详细日志信息，包括：
- 数据库连接状态
- 集合访问结果
- 云函数调用详情
- 错误信息和堆栈

### 4. 常见问题解决

#### 问题1: 集合不存在
如果日志显示 "DATABASE_COLLECTION_NOT_EXIST"：
- 点击 "初始化数据库集合" 按钮
- 或手动在云开发控制台创建集合

#### 问题2: 权限不足
如果日志显示 "DATABASE_PERMISSION_DENIED"：
- 检查集合权限设置
- 确保所有用户都有读写权限

#### 问题3: 无效的奖励类型
如果导入失败并提到 rewardType：
- 确保使用有效的奖励类型：physical, privilege, experience, virtual, charity

### 5. 修复后的验证
调试成功后，返回模板导入页面重新尝试导入。

## 技术细节

### 数据库集合
- `task_templates` - 任务模板
- `reward_templates` - 奖励模板
- `template_import_export_records` - 导入导出记录

### 云函数
- `manageTemplateData` - 模板数据管理
- `initTemplateCollections` - 集合初始化
- `initDatabase` - 完整数据库初始化

### 错误处理
已增强的错误处理包括：
- 详细的错误日志
- 特定错误代码处理
- 集合存在性检查
- 参数验证

## 联系支持
如果问题仍然存在，请提供调试页面的完整日志信息。